{% extends "::base.html.twig" %}
{% block css %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/css/select2.css" rel="stylesheet" type="text/css" />
{% endblock %}
{% block body %}
<div class="row">
	<div class="col-md-4 col-md-offset-4">
		<div class="white-box">
			<form id="formTransfer" method="post">
				<h3 class="box-title text-center">Transferir</h3>
				<label for="">Caja a debitar</label>
				<select required class="select2" name="envia" id="misCajas">
					<option></option>
				</select><br>
				<h6 style="display:none" id="saldo">Saldo : </h6>
				<label for="">Caja destino</label>
				<select required class="select2" name="recibe" id="Cajas">
					<option></option>
				</select><br>
				<br>
				<input hidden type="text" id="monto2" name="monto">
				<input  id="monto" required class="form-control input-lg" placeholder="0,00 R$" type="text"><br>
				<button id="send" class="btn btn-primary center-block">Enviar</button><br>
				<p id="montoMessage" style="display:none" class="text-danger">Saldo insuficiente</p>
			</form>
		</div>
	</div>
</div>
{% endblock %}
{% block javascripts %}
<script src="{{ asset ('js/maskMoney/src/jquery.maskMoney.js')}}" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/js/select2.js" type="text/javascript"></script>
<script>
$(document).ready(function(){
	console.log({{newCajas | raw}});
	$('#misCajas').change(function(){
		if (!$('#misCajas').val()) {
			$('#saldo').hide();
		}
	})
	var data = {{newCajas | raw}};
	var data2 = {{newCajas2 | raw}};
	function formatState (state) {
		//console.log(state);
  //var baseUrl = "/user/pages/images/flags";
  var $state = $(
  	`<p>
  	<div style="background-image: url(/img/allImg/${state.image});" class="img-flag alineado"></div>
  	${state.text}
  	</p>`
  	);
  return $state;
};

	// For select 2
	$("#misCajas").select2({
		placeholder: "Seleccione una caja",
		allowClear: true,
		data:data,
		templateResult: formatState,
	});
	// For select 2
	$("#Cajas").select2({
		placeholder: "Seleccione una caja",
		allowClear: true,
		data:data2,
		templateResult: formatState,
	});
	var saldo = 0;
	$('#misCajas').on('select2:select', function (e) {
		var data = e.params.data;
		saldo = data.saldo
		if ($('#misCajas').val()) {
			console.log('black');
			$('#saldo').text('Saldo : ' + saldo);
			$('#saldo').show();
		}else{
			console.log('blue');
		}
		console.log(data);
	});

	$("#monto").maskMoney({thousands:'.', decimal:',', allowZero: true, suffix: ' R$'});
	$('#formTransfer').on('submit',function(e){
		e.preventDefault();
	})
	$('#send').click(function(){
		var monto = $('#monto').maskMoney('unmasked')[0];
		console.log(monto);
		console.log(saldo);
		if ($('#misCajas').val()) {
			if (saldo - monto >= 0) {
				$('#montoMessage').hide();
				$('#formTransfer').unbind('submit');
				$('#monto2').val(monto);
				$('#formTransfer').trigger('submit');
				$('#send').unbind('click');
			}else{
				$('#montoMessage').show();
			}
		}
	})
});
</script>
{% endblock %}
